<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Guardias</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="app">
        <h1>Guardias Diarias</h1>

        <!-- Tabla de Guardias -->
        <table border="1">
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Profesor</th>
                    <th>Grupo</th>
                    <th>Aula</th>
                    <th>Solución</th>
                    <th>Alumnos Problemáticos</th>
                    <th>Firma</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="guardia in guardias" :key="guardia.hora">
                    <td>{{ guardia.hora }}</td>
                    <td>{{ guardia.profesor }}</td>
                    <td>{{ guardia.grupo }}</td>
                    <td>{{ guardia.aula }}</td>
                    <td>{{ guardia.solucion }}</td>
                    <td>{{ guardia.alumnos_problematicos ? 'Sí' : 'No' }}</td>
                    <td>{{ guardia.firma ? 'Firmado' : 'Pendiente' }}</td>
                </tr>
            </tbody>
        </table>

        <!-- Formulario para Añadir Guardia -->
        <h2>Registrar Guardia</h2>
        <form @submit.prevent="registrarGuardia">
            <label for="hora">Hora:</label>
            <input type="text" id="hora" v-model="nuevaGuardia.hora" required><br><br>

            <label for="profesor">Profesor:</label>
            <select id="profesor" v-model="nuevaGuardia.profesor" required>
                <option v-for="profesor in profesores" :key="profesor.id" :value="profesor.nombre">{{ profesor.nombre }}</option>
            </select><br><br>

            <label for="grupo">Grupo:</label>
            <input type="text" id="grupo" v-model="nuevaGuardia.grupo" required><br><br>

            <label for="aula">Aula:</label>
            <input type="text" id="aula" v-model="nuevaGuardia.aula" required><br><br>

            <label for="solucion">Solución:</label>
            <input type="text" id="solucion" v-model="nuevaGuardia.solucion" required><br><br>

            <label for="alumnos_problematicos">Alumnos Problemáticos:</label>
            <input type="checkbox" id="alumnos_problematicos" v-model="nuevaGuardia.alumnos_problematicos"><br><br>

            <button type="submit">Registrar Guardia</button>
        </form>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    profesores: [],  // Lista de profesores
                    guardias: [],  // Lista de guardias
                    nuevaGuardia: {
                        hora: '',
                        profesor: '',
                        grupo: '',
                        aula: '',
                        solucion: '',
                        alumnos_problematicos: false,
                        firma: false
                    }
                };
            },
            mounted() {
                this.cargarDatos();
            },
            methods: {
                // Cargar datos de los profesores y guardias
                cargarDatos() {
                    // Obtener los datos de los profesores
                    $.get('http://localhost:3000/profesores', (data) => {
                        this.profesores = data;
                    });

                    // Obtener los datos de las guardias
                    $.get('http://localhost:3000/guardias', (data) => {
                        this.guardias = data;
                    });
                },

                // Registrar una nueva guardia
                registrarGuardia() {
                    const nuevaGuardia = { ...this.nuevaGuardia, firma: false };
                    
                    // Hacer un POST al servidor para añadir la nueva guardia
                    $.post('http://localhost:3000/guardias', nuevaGuardia, (data) => {
                        this.guardias.push(data);  // Añadir la nueva guardia a la lista
                        this.limpiarFormulario();
                    });
                },

                // Limpiar el formulario después de registrar la guardia
                limpiarFormulario() {
                    this.nuevaGuardia = {
                        hora: '',
                        profesor: '',
                        grupo: '',
                        aula: '',
                        solucion: '',
                        alumnos_problematicos: false,
                        firma: false
                    };
                }
            }
        });

        app.mount('#app');
    </script>
</body>
</html>
