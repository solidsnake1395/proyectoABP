<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Horario de Guardias</title>
    <link rel="stylesheet" href="css/estilo.css" />
    <link rel="icon" href="https://iesescultorjoseluissanchez.com/wp-content/uploads/2024/08/01-LOGO_TRANSPARENTE-MORADOx120.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.0/dist/vue.global.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        main {
            display: flex;
            justify-content: space-between;
        }
        main div {
            width: 18%; /* Distribuye las columnas */
            padding: 10px;
            border: 1px solid black;
            text-align: center;
        }
        .guardia {
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #ccc;
            background-color: rgb(202, 238, 177); /* Verde por defecto */
        }
        .sin-firmar {
            background-color: rgb(221, 177, 177); /* Rojo si no está firmada */
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Horario de Guardias</h1>
        <main>
            <div v-for="dia in dias" :id="dia.toLowerCase()" :key="dia">
                <strong>{{ dia }}</strong>
                <div v-for="(hora, index) in horas" :key="hora" 
                     :id="'hora' + (index + 1)" 
                     class="guardia"
                     :class="{ 'sin-firmar': tieneGuardiasSinFirmar(dia, hora) }">
                    <template v-if="obtenerGuardias(dia, hora).length">
                        <div v-for="guardia in obtenerGuardias(dia, hora)" :key="guardia.id">
                            {{ obtenerProfesorNombre(guardia.profesor_id) }} ({{ guardia.aula }})
                        </div>
                    </template>
                    <template v-else>
                        {{ hora }}
                    </template>
                </div>
            </div>
        </main>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    dias: ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes"],
                    horas: [
                        "08:30 - 09:25", "09:25 - 10:20", "10:20 - 11:15",
                        "11:15 - 11:45", "11:45 - 12:40", "12:40 - 13:35", "13:35 - 14:30"
                    ],
                    profesores: [],
                    guardias: []
                };
            },
            mounted() {
                this.cargarDatos();
            },
            methods: {
                cargarDatos() {
                    $.get("http://localhost:3000/profesores", (data) => {
                        this.profesores = data;
                    });
                    $.get("http://localhost:3000/guardias", (data) => {
                        this.guardias = data;
                    });
                },
                obtenerProfesorNombre(profesor_id) {
                    const profesor = this.profesores.find(p => p.id === profesor_id);
                    return profesor ? profesor.nombre : "Desconocido";
                },
                obtenerGuardias(dia, hora) {
                    return this.guardias.filter(g => g.hora === hora && g.dia === dia);
                },
                tieneGuardiasSinFirmar(dia, hora) {
                    return this.obtenerGuardias(dia, hora).some(g => !g.registro_firmado);
                }
            }
        });
        app.mount("#app");
    </script>
</body>
</html>
